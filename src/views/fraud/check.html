{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/details/macro.njk" import govukDetails %}

{% extends "base-form.njk" %}
{% set hmpoPageKey = "check" %}
{% set gtmJourney = "fraud" %}

{% set isPageDataSensitive = false %}
{% set statusCode = 200 %}
{% set pageTitleKey = "pages.check.title" %}
{% set contentID = "a5df0735-aa9f-46be-b9dc-fedea5fdd498" %}
{% set taxLevel2 = 'fraud' %}
{% set isPageDynamic = false %}
{% set loggedInStatus = true %}

{% block mainContent %}
  <h1 id="header" class="govuk-heading-l">{{translate("pages.check.title")}}
  </h1>
  {% call hmpoForm(ctx) %}

  {{ hmpoHtml(translate("pages.check.content")) }}

  {{ govukDetails({
  summaryText: translate("pages.check.details.summary"),
  html: hmpoHtml(translate("pages.check.details.text"))
}) }}

  {{ hmpoHtml(translate("pages.check.contentContinued")) }}

  {{ hmpoSubmit(ctx, {
        id: "continue",
        text: translate("buttons.next"),
        attributes: {
          "data-nav": true,
          "data-link": "/oauth2/callback"
        }

    }) }}

  {% endcall %}
{% endblock %}

{% block scripts %}

  {{ super ()}}

  <script nonce="{{ cspNonce }}">
    var formSubmitted = false;

    submitSpinner()

    function delayDisableButton(button) {
      button.className += ' button--spinner'
      setTimeout(function () {
        button.setAttribute('disabled', 'disabled')
      }, 200);
    }

    function submitSpinner() {
      var selects = document.getElementById('continue')

      selects.addEventListener('click', function (event) {
        if (!formSubmitted) {
          formSubmitted = true;

          delayDisableButton(event.target);
        } else {
          event.preventDefault()
        }
      })
    }
  </script>

{% endblock %}